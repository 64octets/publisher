<h2>Viewing Edition <%= @latest_edition.version_number %> of &ldquo;<%= @guide.title %>&rdquo;</h2>
<% if @latest_edition.in_review? %>
<div class="notification">
<p><%= @latest_edition.latest_action.requester.name %> has requested this edition be reviewed</p>
<div class="workflow_buttons">
<%= review_buttons(@guide,@latest_edition)%>
</div>
<%= review_forms(@guide,@latest_edition)%>
</div>
<% end %>
<div id="guide-controls">
  <!-- <p><a href="#" class="external">Formatting help</a></p> -->
  <span class="workflow_buttons">

  <!-- Fake save button -->
  <form id="save-edition" class="button_to">
  <input type="submit" value="Save" class="update">
  </form>
  
  <%= progress_buttons(@guide,@latest_edition) %>
  </span>
  <%= progress_forms(@guide,@latest_edition) %>
</div>

<div id="guide-nav">
  <ul>
    <li><a href="#edit">Edit</a></li>
    <li><a href="#metadata">Metadata</a></li>
    <li><a href="#history">History</a></li>
  </ul>
  <div id="edit">
    <%= render 'edit' %>
  </div>
  <div id="metadata">
    <%= render :partial => 'metadata', :locals => {:publication => @guide} %>
  </div>
  <div id="history">
    <%= render :partial => 'history', :locals => {:publication => @guide} %>
  </div>
</div>

<% content_for :extra_javascript do %>
<script type="text/javascript" charset="utf-8">
$(function () {
  $('#guide-nav').tabs();
  $('#save-edition').submit(function () {
    $('form.edition').trigger('submit');
    return false;
  })
  $('#edition_title')[0].focus();
  
  var submitted_main_form = false;
  
  $('#request_review_form').submit(function () {
    var main_form = $('#edition_edit');

    if (! submitted_main_form) {
      $.post(
        main_form.attr('action'), 
        main_form.serialize(), 
        function (data, textStatus, jqXHR) {
          submitted_main_form = true;
          $('#request_review_form').trigger('submit');
        }
      );
    }
    
  });
});
</script>
<% end %>