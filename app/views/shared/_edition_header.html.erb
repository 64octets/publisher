<div class="page-title">
  <h1>
    <%= @resource.title %>
  </h1>
  <span class="lead">
    <span class="label label-default" title="Edition">#<%= @resource.version_number %></span>
    <span class="label label-default" title="Format"><%= @resource.format.underscore.humanize %></span>
    <span class="label label-info" title="Status"><%= @resource.status_text %></span>
  </span>
</div>
<% important_note = @resource.important_note %>
<% unless important_note.blank? %>
  <div class="callout callout-danger add-bottom-margin" data-module="toggle">
    <div class="callout-body add-label-margin" style="color: #a94442">
      <%= @resource.important_note.comment %>
    </div>

    <% important_notes = edition_actions(@edition).select{|a| a.request_type == "important_note" } %>

    <div class="text-muted">
      Important note last updated <time datetime="<%= important_note.created_at %>"><%= important_note.created_at.to_date.to_s(:govuk_date_short) %></time>
      <% if important_note.requester.present? %> by <%= mail_to important_note.requester.email, important_note.requester.name, { class: 'link-inherit' }  %><% end %> &bull; <a href="#" class="link-inherit js-toggle">All important notes (<%= important_notes.size %>)</a>
    </div>

    <table class="table table-bordered table-striped add-top-margin remove-bottom-margin js-toggle-target if-js-hide">
      <thead>
        <tr class="table-header">
          <th class="important-notes-date-col" style="width: 150px">Date</th>
          <th class="important-notes-author-col" style="width: 150px">Author</th>
          <th class="important-notes-note-col">Note</th>
        </tr>
      </thead>
      <tbody>
        <% important_notes.each do |action| %>
          <tr>
            <td><%= action.created_at.to_date.to_s(:govuk_date) %></td>
            <td><%= mail_to action.requester.email, action.requester.name if action.requester %></td>
            <td><%= action_note(action) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

  </div>
<% end %>
<% if @resource.artefact.state == "archived" %>
  <div class="callout callout-danger add-bottom-margin">
    <h2 class="callout-title">You can’t edit this publication</h2>
    <div class="callout-body">
      This publication’s artefact file has been archived in Panopticon.<br />
      It’s unpublished from the website but you can still see the latest edition here.
    </div>
  </div>
<% else %>
  <%= render 'shared/ready_or_review_or_fact_check' %>
<% end %>
